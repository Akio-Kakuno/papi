LIBRARY   = libpapi.a
SHLIB     = libpapi.so
SUBSTR  = linux-perfctr
DESCR	= "Linux with PerfCtr patch for all Pentiums and the AMD K7"
LIBS	= static shared
TARGETS = serial multiplex_and_pthreads 

KERNINC	= /usr/src/linux-2.4.13/include
PERFCTR	= ./perfctr-2.3
CFLAGS  = -I$(PERFCTR)/usr.lib -I$(PERFCTR)/linux/include -I$(KERNINC) -I. -DPERFCTR20 
#-DDEBUG -DMPX_DEBUG -DMPX_DEBUG_TIMER
OPTFLAGS= -O3 -fomit-frame-pointer -mpentiumpro
TOPTFLAGS= -O0 -fomit-frame-pointer -mpentiumpro
CC	= gcc
#
#  G77 section
F77   = g77
FFLAGS        = -Dlinux
FOPTFLAGS= $(OPTFLAGS)
FTOPTFLAGS= -O0
# #
# #  Portland Group PGF77 section
# F77       = pgf77
# FFLAGS    = -Dlinux
# FOPTFLAGS = -O3 -tp p6
# FTOPTFLAGS= $(FOPTFLAGS)
# #
# #  Intel Corp. Fortran compiler
# F77      = ifc
# FFLAGS   = -Dlinux
# LDFLAGS  = -lPEPCF90  # Intel portability library (getarg_)
# FOPTFLAGS= -O3 -tpp6
# FTOPTFLAGS= $(FOPTFLAGS)

CC_SHR  = $(CC) -shared -Xlinker "-soname" -Xlinker "libpapi.so" -Xlinker "-rpath" -Xlinker "$(PWD)"
CC_R	= $(CC) -pthread
MISCOBJS= libperfctr.o
MISCHDRS= x86-events.h
SHLIBOBJS = $(MISCOBJS)

include Makefile.inc

x86-events.h: $(PERFCTR)/usr.lib/event_codes.h
	cp ./$(PERFCTR)/usr.lib/event_codes.h $@

libperfctr.o: $(PERFCTR)/usr.lib/libperfctr.o
	cp ./$(PERFCTR)/usr.lib/libperfctr.o .

$(PERFCTR)/usr.lib/event_codes.h $(PERFCTR)/usr.lib/libperfctr.o: null
	$(MAKE) -C $(PERFCTR)

native_clean:
	rm -f $(MISCHDRS)
	$(MAKE) -C $(PERFCTR) clean

null:

