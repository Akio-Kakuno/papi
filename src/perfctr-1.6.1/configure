#!/bin/sh

option() {
	TEMP="`echo X"$2" | sed -e 's/^X--[^=]*=//'`"
	eval $1=\"$TEMP\"
}

usage() {
	if [ "$1" != "--help" ]; then
		echo "$0: bad option '$1'"
	fi
	echo "usage: $0 options.."
	echo ""
	echo "  --incldir=DIR    use kernel include files at DIR"
	echo "  --help           display usage information"
	exit 1
}

# prompt question-string default-result result-variable
prompt() {
	eval $3=\"$2\"
	/bin/echo -n "$1 [$2]: "
	read tmp
	if [ -n "$tmp" ]; then
		eval $3=\"$tmp\"
	fi
}

if [ -r config.out ]; then
	. ./config.out
fi

INCLDIR_DEFAULT=$INCLDIR
INCLDIR=

while [ $# -gt 0 ]; do
	case "$1" in
	--incldir=*)
		option INCLDIR $1
		;;
	*)
		usage "$1"
	esac
	shift
done

echo ""
echo "  -- Linux x86 Performance-Monitoring Counters Configuration Script --"
echo ""

if [ -z "$INCLDIR" ]; then
	prompt "Linux include files directory" "$INCLDIR_DEFAULT" INCLDIR
fi
if [ ! -d "$INCLDIR" ]; then
	echo "'$INCLDIR' does not exist"
	exit 1
elif [ ! -f "$INCLDIR/asm/perfctr.h" ]; then
	echo "'$INCLDIR/asm/perfctr.h' is missing"
	exit 1
fi

cat > config.out << EOF
INCLDIR=$INCLDIR
EOF

echo ""
echo "Configuration successful."
echo ""
exit 0
